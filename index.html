<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>מנהל עישון</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f6f6f6;
      margin-top: 40px;
      direction: rtl;
    }
    button {
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
      cursor: pointer;
      transition: background 0.2s;
      box-shadow: 0 2px 10px #0001;
    }
    button:active {
      background: #388E3C;
    }
    button:disabled {
      background: #aaa;
      cursor: not-allowed;
      opacity: 0.7;
    }
    .info {
      font-size: 20px;
      margin: 15px 0;
      color: #333;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 1px 4px #0001;
      display: inline-block;
      padding: 10px 22px;
    }
    h1 {
      color: #4CAF50;
      margin-bottom: 32px;
      font-size: 2.2em;
      letter-spacing: 2px;
      text-shadow: 0 2px 10px #4CAF5020;
    }
    #timer {
      font-weight: bold;
      color: #E64A19;
    }
  </style>
</head>
<body>

  <h1>מנהל עישון</h1>

  <div class="info">מספר פארשים נוכחי: <span id="parsh">0</span></div>
  <div class="info">סה״כ עישונים: <span id="count">0</span></div>
  <div class="info">טיימר: <span id="timer">מוכן לעישון</span></div>

  <button id="smokeBtn">עישנתי</button>

  <script>
    const smokeBtn = document.getElementById("smokeBtn");
    const timerLabel = document.getElementById("timer");
    const countLabel = document.getElementById("count");
    const parshLabel = document.getElementById("parsh");

    // קריאה מה-localStorage
    let count = parseInt(localStorage.getItem("count")) || 0;
    let startDate = localStorage.getItem("startDate");
    let timerEnd = localStorage.getItem("timerEnd");

    // אם אין תאריך התחלה – נשמור חדש
    if (!startDate) {
      startDate = new Date().toISOString();
      localStorage.setItem("startDate", startDate);
    }

    // כמה פארשים להתחיל איתם
    const startParsh = 3; // אפשר לשנות אם תרצה

    // פונקציה לחישוב ימים שעברו
    function daysSinceStart() {
      const diff = new Date() - new Date(startDate);
      return Math.floor(diff / (1000 * 60 * 60 * 24));
    }

    // עדכון פארשים
    function updateParsh() {
      const parsh = startParsh + Math.floor(daysSinceStart() / 3);
      parshLabel.textContent = parsh;
      return parsh;
    }

    // טיימר
    let timerInterval;
    function startTimer(seconds) {
      const endTime = Date.now() + seconds * 1000;
      localStorage.setItem("timerEnd", endTime);
      timerEnd = endTime;

      smokeBtn.disabled = true;
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      const endTime = parseInt(localStorage.getItem("timerEnd"));
      const remaining = endTime - Date.now();

      if (remaining <= 0 || isNaN(endTime)) {
        clearInterval(timerInterval);
        localStorage.removeItem("timerEnd");
        timerLabel.textContent = "מוכן לעישון";
        smokeBtn.disabled = false;
        return;
      }

      const minutes = Math.floor(remaining / 60000);
      const seconds = Math.floor((remaining % 60000) / 1000);
      timerLabel.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      smokeBtn.disabled = true;
    }

    // כפתור עישנתי
    smokeBtn.addEventListener("click", () => {
      count++;
      localStorage.setItem("count", count);
      countLabel.textContent = count;
      updateParsh();
      startTimer(3600); // שעה
    });

    // בעת טעינה
    countLabel.textContent = count;
    updateParsh();

    // המשך טיימר אם קיים
    if (timerEnd && Date.now() < parseInt(timerEnd)) {
      timerInterval = setInterval(updateTimer, 1000);
      updateTimer();
      smokeBtn.disabled = true;
    } else {
      timerLabel.textContent = "מוכן לעישון";
      smokeBtn.disabled = false;
    }
  </script>

</body>
</html>
